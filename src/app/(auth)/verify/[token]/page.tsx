"use client";
import { Icons } from "@/components/Icons";
import { signIn } from "next-auth/react";
import Link from "next/link";
import { useRouter } from "next/navigation";

//Generated by GeneratePageFile
import React, { useEffect, useState } from "react";

interface VerifyTokenProps {
  params: { token: string };
}

const VerifyToken: React.FC<VerifyTokenProps> = ({ params }) => {
  const router = useRouter();
  const { token } = params;
  console.log(token);

  const [error, setError] = useState(null);
  const [success, setSuccess] = useState(false);

  useEffect(() => {
    const signInUsingToken = async () => {
      try {
        const response = await signIn("token", { token, redirect: false });
        if (response && !response.error) {
          setSuccess(true);
        }
        console.log(response);
      } catch (e: any) {
        console.log(e);
        const error = e.response?.data?.error;
        setError(error);
      }
    };

    console.log(success);

    if (success) {
      setTimeout(() => {
        router.replace("/");
      }, 1000);
    } else {
      signInUsingToken();
    }
  }, [success]);

  return (
    <div className="flex flex-col items-center flex-1 px-4 pt-5">
      <h1 className="text-2xl">
        {error
          ? "Account verification failed."
          : success
          ? "Account Verified"
          : "Verifying Account"}
      </h1>
      <div className="flex items-center justify-center w-full">
        {error ? (
          <div>
            Go to the{" "}
            <Link
              href="/login"
              className="underline underline-offset-2"
            >
              login
            </Link>{" "}
            or{" "}
            <Link
              href="/register"
              className="underline underline-offset-2"
            >
              registration
            </Link>{" "}
            page
          </div>
        ) : (
          <>
            <span>
              {success
                ? "Redirecting to Home Page.."
                : "Please wait while we verify your account..."}
            </span>
            <Icons.loading className="ml-4 animate-spin" />
          </>
        )}
      </div>
    </div>
  );
};

export default VerifyToken;
